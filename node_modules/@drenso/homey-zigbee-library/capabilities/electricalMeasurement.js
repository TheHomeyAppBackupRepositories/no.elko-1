"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const zigbee_clusters_1 = require("zigbee-clusters");
const deviceFactor_1 = __importDefault(require("../lib/helper/deviceFactor"));
async function initElectricalMeasurementDevice(device, zclNode, { endpointId, useInstantaneousDemand, noPowerFactorReporting, } = {}) {
    if (device.hasCapability('measure_voltage')) {
        device.log('Initialising measure_voltage capability');
        await (0, deviceFactor_1.default)(device, zclNode, 'measure_voltage', zigbee_clusters_1.CLUSTER.ELECTRICAL_MEASUREMENT, 'acVoltageFactor', endpointId, noPowerFactorReporting)
            .then(() => device.log('Initialised measure_voltage capability'))
            .catch(e => device.error('Failed to initialise measure_voltage capability', e));
    }
    if (device.hasCapability('measure_current')) {
        device.log('Initialising measure_current capability');
        await (0, deviceFactor_1.default)(device, zclNode, 'measure_current', zigbee_clusters_1.CLUSTER.ELECTRICAL_MEASUREMENT, 'acCurrentFactor', endpointId, noPowerFactorReporting)
            .then(() => device.log('Initialised measure_current capability'))
            .catch(e => device.error('Failed to initialise measure_current capability', e));
    }
    if (device.hasCapability('measure_power')) {
        device.log('Initialising measure_power capability');
        await (0, deviceFactor_1.default)(device, zclNode, 'measure_power', useInstantaneousDemand ? zigbee_clusters_1.CLUSTER.METERING : zigbee_clusters_1.CLUSTER.ELECTRICAL_MEASUREMENT, useInstantaneousDemand ? 'instantaneousDemandFactor' : 'activePowerFactor', endpointId, noPowerFactorReporting)
            .then(() => device.log('Initialised measure_power capability'))
            .catch(e => device.error('Failed to initialise measure_power capability', e));
    }
    device.log('Electrical measurement device initialized!');
}
exports.default = initElectricalMeasurementDevice;
